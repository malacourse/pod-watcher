<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/QAPage">
<head>
    <title>Pod Monitor</title>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.4.2.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://knockoutjs.com/js/jquery-1.11.1.min.js"></script>
    <style>
       .podRowAlert {color:red;}
       .podRowNormal {color:black;}
    </style>
    <meta http-equiv="refresh" content="60">
<body>
<script>
  function podsModel() {
    var self = this;
    self.pods = ko.observableArray([]);
    self.config = ko.observable();
    $.getJSON("/status",function (data) {
            self.pods(data.pods);
            self.config(data.config);
            console.log("Data:" + JSON.stringify(data));
            console.log("Config:" + self.config);
        }
    );
};

 $(document).ready(function() {
    ko.applyBindings(new podsModel());
});
</script>
<h1>Pod Monitor</h1>
<br/>
<a href="/config">Pod Monitory Configuration page</a>
<br>
<a href="/pod-restart-alerts">Get Alerts</a>
<br><br>
<div class="configInfo">
<table>
    <thead>
        <tr>
          <th>Restart Threshold</th>
          <th>Timeframe(minutes)</th>
      </tr>
    </thead>
    <tbody data-bind="with: config">
        <tr>
            <td data-bind="text: threshold"></td>
            <td data-bind="text: timeframe"></td>
        </tr>
    </tbody>
</table>
</div>
<br><br>
<div class="podStatus">
<table border="1">
    <thead>
        <tr>
	  <th>Name</th>
          <th>Total Restart Count</th>
          <th>Current Count</td>
          <th>Alert Status</th>
          <th>Last Update</th>
          <th>Restart Times</th>
          <th>State</th>
      </tr>
    </thead>
    <tbody data-bind="foreach: pods">
        <tr data-bind="attr: {'class' : alertStatus == 'Warn' ? 'podRowAlert' : 'podRowNormal'}">
            <td data-bind="text: podName"></td>
            <td data-bind="text: totalRestartCount"></td>
             <td data-bind="text: currentRestarts"</td>
             <td data-bind="text: alertStatus"></td>
             <td data-bind="text: lastUpdateTime"</td>
             <td data-bind="text: restarts"</td>
            <td data-bind="text: JSON.stringify(state)"></td>
        </tr>
    </tbody>
</table>
</div> 
</body>
</html>
